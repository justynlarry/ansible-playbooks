---

- name: Bootstrap Docker Management User
  hosts: db-servers
  become: true
  gather_facts: true

  vars:
    ansible_ssh_pass: "{{ vault_ansible_ssh_pass }}"

  pre_tasks:
  - name: Install Updates (Ubuntu/Debian)
    tags: always
    apt:
      upgrade: yes
      update_cache: yes
    when: ansible_distribution in ["Debian", "Ubuntu"]


  tasks:
  - name: Create Docker User (docker-user)
    tags: always
    user:
      name: docker-user

  - name: Add Dedicated SSH Key for docker-user
    tags: always
    ansible.posix.authorized_key:
      user: docker-user
      key: "{{ lookup('file', 'files/docker_user_key.pub') }}"

  - name:  Add docker-user to docker group
    tags: always
    user:
      name: docker-user
      groups: docker
      append: yes

